<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guochen.dao.TProjectMapper">
  <resultMap id="BaseResultMap" type="com.guochen.model.TProject">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="pro_code" jdbcType="VARCHAR" property="proCode" />
    <result column="pro_name" jdbcType="VARCHAR" property="proName" />
    <result column="file_id" jdbcType="VARCHAR" property="fileId" />
    <result column="con_name" jdbcType="VARCHAR" property="conName" />
    <result column="con_phone" jdbcType="VARCHAR" property="conPhone" />
    <result column="pro_starttime" jdbcType="VARCHAR" property="proStarttime" />
    <result column="pro_endtime" jdbcType="VARCHAR" property="proEndtime" />
    <result column="se_me" jdbcType="VARCHAR" property="seMe" />
    <result column="pro_profile" jdbcType="VARCHAR" property="proProfile" />
    <result column="bi_an" jdbcType="VARCHAR" property="biAn" />
    <result column="pro_status" jdbcType="VARCHAR" property="proStatus" />
    <result column="offer_num" jdbcType="VARCHAR" property="offerNum" />
    <result column="buyer_id" jdbcType="INTEGER" property="buyerId" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="update_time" jdbcType="VARCHAR" property="updateTime" />
    <result column="alternate_field1" jdbcType="VARCHAR" property="alternateField1" />
    <result column="alternate_field2" jdbcType="VARCHAR" property="alternateField2" />
    <collection property="buyer" column="buyer_id"  ofType="com.guochen.model.TBuyer" 
    	select="com.guochen.dao.TBuyerMapper.selectByPrimaryKey"/>
  </resultMap>
  <resultMap id="BaseResultMap_mobile" type="com.guochen.model.TProject">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="pro_code" jdbcType="VARCHAR" property="proCode" />
    <result column="pro_name" jdbcType="VARCHAR" property="proName" />
    <result column="file_id" jdbcType="VARCHAR" property="fileId" />
    <result column="con_name" jdbcType="VARCHAR" property="conName" />
    <result column="con_phone" jdbcType="VARCHAR" property="conPhone" />
    <result column="pro_starttime" jdbcType="VARCHAR" property="proStarttime" />
    <result column="pro_endtime" jdbcType="VARCHAR" property="proEndtime" />
    <result column="se_me" jdbcType="VARCHAR" property="seMe" />
    <result column="pro_profile" jdbcType="VARCHAR" property="proProfile" />
    <result column="bi_an" jdbcType="VARCHAR" property="biAn" />
    <result column="pro_status" jdbcType="VARCHAR" property="proStatus" />
    <result column="offer_num" jdbcType="VARCHAR" property="offerNum" />
    <result column="buyer_id" jdbcType="INTEGER" property="buyerId" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="update_time" jdbcType="VARCHAR" property="updateTime" />
    <result column="alternate_field1" jdbcType="VARCHAR" property="alternateField1" />
    <result column="alternate_field2" jdbcType="VARCHAR" property="alternateField2" />
    <collection property="buyer" column="buyer_id"  ofType="com.guochen.model.TBuyer" 
    	select="com.guochen.dao.TBuyerMapper.selectByPrimaryKey"/>
  </resultMap>
  
  <sql id="Base_Column_List" >
    id, pro_code, pro_name, file_id, con_name, con_phone,pro_starttime,pro_endtime,se_me,pro_profile,bi_an,pro_status,
    offer_num,buyer_id,create_time,update_time,alternate_field1,alternate_field2
  </sql>
  
  <sql id="Base_Where_Condition" >
		<if test="proName!=null and proName.trim().length()>0">
			and pro_name like '%${proName}%'
		</if>
		<if test="queryDate1!=null and queryDate1.trim().length()>0 and queryDate2!=null and queryDate2.trim().length()>0">
			and str_to_date(create_time,'%Y-%m-%d %T') between str_to_date('${queryDate1}','%Y-%m-%d %T') and str_to_date('${queryDate2}','%Y-%m-%d %T') 
		</if>
		<if test="proStatus!=null and proStatus.trim().length()>0">
			and pro_status = '${proStatus}'
		</if>
		<if test="isBeforeEnd!=null and isBeforeEnd eq '1' ">
			and now() &gt; str_to_date(pro_endtime,'%Y-%m-%d %T')
		</if>
		<if test="isBeforeEnd!=null and isBeforeEnd eq '-1' ">
			and now() &lt; str_to_date(pro_endtime,'%Y-%m-%d %T')
		</if>
  </sql>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    delete from t_project
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.guochen.model.TProject" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>-->
    insert into t_project (id, pro_code, pro_name, 
      file_id, con_name, con_phone, 
      pro_starttime, pro_endtime, se_me, 
      pro_profile, bi_an, pro_status, 
      offer_num, buyer_id, create_time, 
      update_time, alternate_field1, alternate_field2
      )
    values (#{id,jdbcType=INTEGER}, #{proCode,jdbcType=VARCHAR}, #{proName,jdbcType=VARCHAR}, 
      #{fileId,jdbcType=VARCHAR}, #{conName,jdbcType=VARCHAR}, #{conPhone,jdbcType=VARCHAR}, 
      #{proStarttime,jdbcType=VARCHAR}, #{proEndtime,jdbcType=VARCHAR}, #{seMe,jdbcType=VARCHAR}, 
      #{proProfile,jdbcType=VARCHAR}, #{biAn,jdbcType=VARCHAR}, #{proStatus,jdbcType=VARCHAR}, 
      #{offerNum,jdbcType=VARCHAR}, #{buyerId,jdbcType=INTEGER}, #{createTime,jdbcType=VARCHAR}, 
      #{updateTime,jdbcType=VARCHAR}, #{alternateField1,jdbcType=VARCHAR}, #{alternateField2,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.guochen.model.TProject">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    update t_project
    set pro_code = #{proCode,jdbcType=VARCHAR},
      pro_name = #{proName,jdbcType=VARCHAR},
      file_id = #{fileId,jdbcType=VARCHAR},
      con_name = #{conName,jdbcType=VARCHAR},
      con_phone = #{conPhone,jdbcType=VARCHAR},
      pro_starttime = #{proStarttime,jdbcType=VARCHAR},
      pro_endtime = #{proEndtime,jdbcType=VARCHAR},
      se_me = #{seMe,jdbcType=VARCHAR},
      pro_profile = #{proProfile,jdbcType=VARCHAR},
      bi_an = #{biAn,jdbcType=VARCHAR},
      pro_status = #{proStatus,jdbcType=VARCHAR},
      offer_num = #{offerNum,jdbcType=VARCHAR},
      buyer_id = #{buyerId,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=VARCHAR},
      alternate_field1 = #{alternateField1,jdbcType=VARCHAR},
      alternate_field2 = #{alternateField2,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_project
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectlist" parameterType="hashmap" resultMap="BaseResultMap">
    select id, pro_code, pro_name, file_id, con_name, con_phone, pro_starttime, pro_endtime, 
    se_me, pro_profile, bi_an, pro_status, offer_num, buyer_id, create_time, update_time, 
    alternate_field1, alternate_field2
    from t_project
    where 1=1
    <if test="starttime !=null and starttime!='' and endtime !=null and endtime!=''">
    	and pro_starttime between #{starttime,jdbcType=VARCHAR} and #{endtime,jdbcType=VARCHAR}
    </if>
    <if test="proName !=null and proName!='' ">
    	and pro_name like #{proName,jdbcType=VARCHAR}
    </if>
    <if test="proStatus !=null and proStatus!='' ">
    	and pro_status = #{proStatus,jdbcType=VARCHAR}
    </if>
    order by create_time desc
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_project 
    
  </select>
    <select id="selectAllOnPage" resultMap="BaseResultMap" parameterType="hashmap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    select id, pro_code, pro_name, file_id, con_name, con_phone, pro_starttime, pro_endtime, 
    se_me, pro_profile, bi_an, pro_status, offer_num, buyer_id, create_time, update_time, 
    alternate_field1, alternate_field2
    from t_project where pro_status=#{status,jdbcType=VARCHAR} 
    order by pro_starttime desc limit #{startNo,jdbcType=INTEGER},#{endNo,jdbcType=INTEGER}
  </select>
  <select id="selectByDate" resultMap="BaseResultMap" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 26 15:46:15 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_project where create_time like #{0,jdbcType=VARCHAR} 
  </select>
  
  <select id="selectPageList" resultMap="BaseResultMap" parameterType="com.guochen.model.TProject">
		select
		<include refid="Base_Column_List" />
		from t_project 
		where 1=1
		<include refid="Base_Where_Condition" />
		order by create_time desc
	</select>
	
	<select id="selectPageCount" resultType="long" parameterType="com.guochen.model.TProject">
		select count(*) 
		from t_project
		where 1=1 
		<include refid="Base_Where_Condition" />
	</select>


	<select id="selectToSelectComPageList" resultMap="BaseResultMap" parameterType="com.guochen.model.TProject">
		select
		<include refid="Base_Column_List" />
		from t_project 
		where 1=1 and pro_status ='2' and id not in (select pro_id from t_contract where app_status in ('0','2')) 
		<include refid="Base_Where_Condition" />
		order by create_time desc 
	</select>

	<select id="selectPageCountToSelectCom" resultType="long" parameterType="com.guochen.model.TProject">
		select count(*) 
		from t_project 
		where 1=1 and pro_status ='2' and id not in (select pro_id from t_contract where app_status in ('0','2')) 
		<include refid="Base_Where_Condition" />
	</select>
	
	<select id="selectAccProjectPageList" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from t_project 
		where 1=1 
		<if test="proName!=null and proName.trim().length()>0">
			and pro_name like '%${proName}%' 
		</if>
		and pro_status ='1' and id not in (select pro_id from t_offer where user_id=#{comId,jdbcType=INTEGER}) 
		order by create_time desc 
	</select>

	<select id="selectAccProjectPageCount" resultType="long" parameterType="java.lang.String">
		select count(*) 
		from t_project 
		where 1=1 
		<if test="proName!=null and proName.trim().length()>0">
			and pro_name like '%${proName}%' 
		</if>
		and pro_status ='1' and id not in (select pro_id from t_offer where user_id=#{comId,jdbcType=INTEGER}) 
	</select>
	
	<select id="selectToVerfyPageList" resultMap="BaseResultMap" parameterType="com.guochen.model.TProject">
		select
		<include refid="Base_Column_List" />
		from t_project 
		where 1=1 
		and id in (
			select pro_id from t_contract where id in (
				select contract_id from t_conapp where app_status in ('0') and node_id in (
					select id from t_node where user_id =#{userId,jdbcType=INTEGER}
				)))
		<include refid="Base_Where_Condition" />
		order by create_time desc
	</select>
	
	<select id="selectToVerfyPageCount" resultType="long" parameterType="com.guochen.model.TProject">
		select count(*) 
		from t_project 
		where 1=1 
		and id in (
			select pro_id from t_contract where id in (
				select contract_id from t_conapp where app_status in ('0') and node_id in (
					select id from t_node where user_id =#{userId,jdbcType=INTEGER}
				)))
		<include refid="Base_Where_Condition" />
	</select>
	<select id="selectToVerfyPageList1" resultMap="BaseResultMap" parameterType="com.guochen.model.TProject">
		select
		<include refid="Base_Column_List" />
		from t_project 
		where 1=1 
		and id in (
			select pro_id from t_contract where id in (
				select contract_id from t_conapp where app_status in ('1') and node_id in (
					select id from t_node where user_id =#{userId,jdbcType=INTEGER}
				)))
		<include refid="Base_Where_Condition" />
		order by create_time desc
	</select>
	
	<select id="selectToVerfyPageCount1" resultType="long" parameterType="com.guochen.model.TProject">
		select count(*) 
		from t_project 
		where 1=1 
		and id in (
			select pro_id from t_contract where id in (
				select contract_id from t_conapp where app_status in ('1') and node_id in (
					select id from t_node where user_id =#{userId,jdbcType=INTEGER}
				)))
		<include refid="Base_Where_Condition" />
	</select>
	<select id = "selectProCountByMouth" resultType="Map">
		select
		  count(*) as num,
		  DATE_FORMAT(t.create_time,'%Y-%m') as dt
		from t_project t
		where pro_status != 0
		    and DATE_FORMAT(t.create_time,'%Y-%m')between DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 5 MONTH),'%Y-%m')
		    and DATE_FORMAT(NOW(),'%Y-%m')
		group by dt
	</select>
	<select id = "selectProCount" resultType="int">
		SELECT COUNT(*) AS num FROM t_project t WHERE pro_status != 0 AND DATE_FORMAT(t.create_time,'%Y-%m')=DATE_FORMAT(NOW(),'%Y-%m')
	</select>
</mapper>